<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Polymarket Trading Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: #e2e8f0;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px 0;
            border-bottom: 2px solid #334155;
        }

        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #60a5fa 0%, #a78bfa 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .timestamp {
            color: #94a3b8;
            font-size: 0.9em;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: rgba(30, 41, 59, 0.8);
            border: 1px solid #334155;
            border-radius: 12px;
            padding: 20px;
            backdrop-filter: blur(10px);
        }

        .card h3 {
            color: #93c5fd;
            margin-bottom: 15px;
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .metric {
            font-size: 2em;
            font-weight: bold;
            margin: 10px 0;
        }

        .metric.positive {
            color: #4ade80;
        }

        .metric.negative {
            color: #f87171;
        }

        .metric.neutral {
            color: #93c5fd;
        }

        .subtext {
            color: #64748b;
            font-size: 0.85em;
            margin-top: 8px;
        }

        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8em;
            margin-top: 10px;
            font-weight: 600;
        }

        .badge.contrarian {
            background: rgba(239, 68, 68, 0.2);
            color: #fca5a5;
            border: 1px solid #dc2626;
        }

        .badge.late-entry {
            background: rgba(251, 146, 60, 0.2);
            color: #fed7aa;
            border: 1px solid #ea580c;
        }

        .strategy-section {
            margin-bottom: 40px;
        }

        .strategy-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #334155;
        }

        .strategy-icon {
            font-size: 1.5em;
        }

        .trades-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: rgba(15, 23, 42, 0.5);
            border-radius: 8px;
            overflow: hidden;
        }

        .trades-table thead {
            background: rgba(30, 41, 59, 0.8);
            border-bottom: 2px solid #334155;
        }

        .trades-table th {
            padding: 12px;
            text-align: left;
            color: #93c5fd;
            font-size: 0.85em;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .trades-table td {
            padding: 12px;
            border-bottom: 1px solid #334155;
        }

        .trades-table tr:hover {
            background: rgba(30, 41, 59, 0.5);
        }

        .status-open {
            color: #fbbf24;
        }

        .status-closed-win {
            color: #4ade80;
        }

        .status-closed-loss {
            color: #f87171;
        }

        .market-name {
            max-width: 300px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .chart-container {
            background: rgba(30, 41, 59, 0.8);
            border: 1px solid #334155;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
            position: relative;
            height: 300px;
        }

        .no-data {
            text-align: center;
            color: #64748b;
            padding: 40px;
        }

        .refresh-info {
            text-align: center;
            color: #64748b;
            font-size: 0.85em;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #334155;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üìä Polymarket Trading Dashboard</h1>
            <p class="timestamp">AI-Powered Prediction Market Trading | Last updated: <span id="timestamp">--:--:--</span></p>
        </header>

        <!-- Overall Stats -->
        <div class="grid">
            <div class="card">
                <h3>üí∞ Total P/L</h3>
                <div class="metric" id="totalPnL">$0.00</div>
                <div class="subtext" id="totalTrades">0 trades closed</div>
            </div>

            <div class="card">
                <h3>üìà Win Rate</h3>
                <div class="metric" id="winRate">0%</div>
                <div class="subtext" id="winRateText">0 wins out of 0</div>
            </div>

            <div class="card">
                <h3>‚è≥ Open Positions</h3>
                <div class="metric neutral" id="openPositions">0</div>
                <div class="subtext">Active trades</div>
            </div>

            <div class="card">
                <h3>üéØ Total Trades</h3>
                <div class="metric neutral" id="allTrades">0</div>
                <div class="subtext" id="avgTradeValue">$0 per trade</div>
            </div>
        </div>

        <!-- Strategy 1: AI Contrarian -->
        <div class="strategy-section">
            <div class="strategy-header">
                <span class="strategy-icon">üî¥</span>
                <h2>AI Contrarian Strategy</h2>
                <span class="badge contrarian">Aggressive</span>
            </div>

            <div class="grid">
                <div class="card">
                    <h3>Strategy P/L</h3>
                    <div class="metric" id="contrarian-pnl">$0.00</div>
                    <div class="subtext" id="contrarian-stats">0 trades</div>
                </div>

                <div class="card">
                    <h3>Win Rate</h3>
                    <div class="metric" id="contrarian-wr">0%</div>
                    <div class="subtext">Targets: Buy < $0.30, Sell > $0.70</div>
                </div>

                <div class="card">
                    <h3>ROI</h3>
                    <div class="metric" id="contrarian-roi">0%</div>
                    <div class="subtext">Return on invested capital</div>
                </div>
            </div>

            <table class="trades-table" id="contrarian-trades">
                <thead>
                    <tr>
                        <th>Market</th>
                        <th>Entry</th>
                        <th>Exit</th>
                        <th>P/L</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>

        <!-- Strategy 2: Late Entry -->
        <div class="strategy-section">
            <div class="strategy-header">
                <span class="strategy-icon">üü°</span>
                <h2>Late Entry Strategy</h2>
                <span class="badge late-entry">Selective</span>
            </div>

            <div class="grid">
                <div class="card">
                    <h3>Strategy P/L</h3>
                    <div class="metric" id="lateentry-pnl">$0.00</div>
                    <div class="subtext" id="lateentry-stats">0 trades</div>
                </div>

                <div class="card">
                    <h3>Win Rate</h3>
                    <div class="metric" id="lateentry-wr">0%</div>
                    <div class="subtext">Targets: Buy < $0.35 (confirmed), Sell > $0.65</div>
                </div>

                <div class="card">
                    <h3>ROI</h3>
                    <div class="metric" id="lateentry-roi">0%</div>
                    <div class="subtext">Return on invested capital</div>
                </div>
            </div>

            <table class="trades-table" id="lateentry-trades">
                <thead>
                    <tr>
                        <th>Market</th>
                        <th>Entry</th>
                        <th>Exit</th>
                        <th>P/L</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>

        <div class="refresh-info">
            Auto-refreshing every 30 seconds | Last sync: <span id="sync-time">--</span>
        </div>
    </div>

    <script>
        async function loadTradeData() {
            try {
                const response = await fetch('trades.json');
                const trades = await response.json();
                
                // Handle both array and object formats
                const tradesList = Array.isArray(trades) ? trades : (trades.trades || []);
                
                updateDashboard(tradesList);
            } catch (error) {
                console.error('Error loading trades:', error);
            }
        }

        function updateDashboard(trades) {
            // Filter trades by strategy
            const contrarian = trades.filter(t => t.strategy === 'AI Contrarian');
            const lateEntry = trades.filter(t => t.strategy === 'Late Entry');
            
            // Calculate overall stats
            const closedTrades = trades.filter(t => t.status === 'CLOSED');
            const openTrades = trades.filter(t => t.status === 'OPEN');
            
            const totalPnL = closedTrades.reduce((sum, t) => sum + (t.pnl || 0), 0);
            const wins = closedTrades.filter(t => (t.pnl || 0) > 0).length;
            const winRate = closedTrades.length > 0 ? (wins / closedTrades.length * 100).toFixed(1) : 0;
            
            // Update overall metrics
            document.getElementById('totalPnL').className = `metric ${totalPnL >= 0 ? 'positive' : 'negative'}`;
            document.getElementById('totalPnL').textContent = `$${totalPnL.toFixed(2)}`;
            document.getElementById('totalTrades').textContent = `${closedTrades.length} closed`;
            document.getElementById('winRate').textContent = `${winRate}%`;
            document.getElementById('winRateText').textContent = `${wins} wins out of ${closedTrades.length}`;
            document.getElementById('openPositions').textContent = openTrades.length;
            document.getElementById('allTrades').textContent = trades.length;
            
            const avgTradeValue = trades.length > 0 ? (totalPnL / closedTrades.length).toFixed(2) : 0;
            document.getElementById('avgTradeValue').textContent = `$${avgTradeValue} per trade`;
            
            // Update Contrarian stats
            updateStrategyStats('contrarian', contrarian);
            updateStrategyStats('lateentry', lateEntry);
            
            // Update tables
            populateTradesTable('contrarian-trades', contrarian);
            populateTradesTable('lateentry-trades', lateEntry);
            
            // Update timestamp
            document.getElementById('timestamp').textContent = new Date().toLocaleTimeString();
            document.getElementById('sync-time').textContent = new Date().toLocaleTimeString();
        }

        function updateStrategyStats(strategyId, trades) {
            const closedTrades = trades.filter(t => t.status === 'CLOSED');
            const openTrades = trades.filter(t => t.status === 'OPEN');
            
            const pnl = closedTrades.reduce((sum, t) => sum + (t.pnl || 0), 0);
            const wins = closedTrades.filter(t => (t.pnl || 0) > 0).length;
            const wr = closedTrades.length > 0 ? (wins / closedTrades.length * 100).toFixed(1) : 0;
            
            // Calculate ROI (assuming $10 per trade)
            const invested = closedTrades.length * 10;
            const roi = invested > 0 ? ((pnl / invested) * 100).toFixed(1) : 0;
            
            document.getElementById(`${strategyId}-pnl`).className = `metric ${pnl >= 0 ? 'positive' : 'negative'}`;
            document.getElementById(`${strategyId}-pnl`).textContent = `$${pnl.toFixed(2)}`;
            document.getElementById(`${strategyId}-stats`).textContent = `${closedTrades.length} closed, ${openTrades.length} open`;
            document.getElementById(`${strategyId}-wr`).textContent = `${wr}%`;
            document.getElementById(`${strategyId}-roi`).className = `metric ${roi >= 0 ? 'positive' : 'negative'}`;
            document.getElementById(`${strategyId}-roi`).textContent = `${roi}%`;
        }

        function populateTradesTable(tableId, trades) {
            const tbody = document.querySelector(`#${tableId} tbody`);
            tbody.innerHTML = '';
            
            if (trades.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" class="no-data">No trades yet</td></tr>';
                return;
            }
            
            trades.forEach(trade => {
                const row = document.createElement('tr');
                const status = trade.status === 'OPEN' ? 'status-open' : 
                              (trade.pnl > 0 ? 'status-closed-win' : 'status-closed-loss');
                
                row.innerHTML = `
                    <td><div class="market-name">${trade.question?.substring(0, 40)}...</div></td>
                    <td>$${trade.entry_price?.toFixed(2)}</td>
                    <td>${trade.exit_price ? '$' + trade.exit_price.toFixed(2) : '--'}</td>
                    <td class="${trade.pnl ? (trade.pnl > 0 ? 'positive' : 'negative') : ''}">${trade.pnl ? '$' + trade.pnl.toFixed(2) : '--'}</td>
                    <td class="${status}">${trade.status}</td>
                `;
                tbody.appendChild(row);
            });
        }

        // Initial load
        loadTradeData();

        // Auto-refresh every 30 seconds
        setInterval(loadTradeData, 30000);
    </script>
</body>
</html>
